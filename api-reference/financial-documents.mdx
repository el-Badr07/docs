---
title: "Financial Documents API Reference"
description: "Complete API reference for processing various financial documents including bank statements, receipts, and expense reports"
---

The Financial Documents API extends Textra's document processing capabilities beyond invoices to handle a comprehensive range of financial documents. This API provides specialized processing workflows for bank statements, receipts, expense reports, and other financial documents while maintaining the same high standards of accuracy and French accounting compliance.

## System Architecture

### Document Processing Pipeline

The Financial Documents API uses an **asynchronous task-based architecture** built on:

- **RabbitMQ Message Queue**: Reliable task distribution and processing
- **Background Workers**: Specialized workers for different document types
- **Task Management**: Priority-based task scheduling and monitoring
- **MongoDB Storage**: Document metadata and processing results storage

### Supported Document Types

The API supports processing of multiple financial document types with specialized handlers:

**Primary Documents:**
- **BANK_STATEMENT**: Bank account statements with transaction extraction
- **PAYROLL_DOCUMENT**: Employee payroll and salary documents
- **EXPENSE_RECEIPT**: Employee expense receipts and reimbursements
- **PURCHASE_ORDER**: Purchase orders and procurement documents
- **DELIVERY_NOTE**: Goods receipt and delivery documentation

**Secondary Documents:**
- **CONTRACT**: Service agreements and contract analysis
- **CREDIT_NOTE**: Credit memos with original invoice linking
- **DEBIT_NOTE**: Debit notes and additional charges
- **PAYMENT_VOUCHER**: Payment authorization and tracking
- **TAX_DOCUMENT**: VAT returns and tax-related documents

**Specialized Documents:**
- **CASH_RECEIPT**: Cash transaction receipts
- **GOVERNMENT_DOCUMENT**: Government forms and regulatory documents
- **SUPPLIER_STATEMENT**: Supplier account statements
- **CUSTOMER_PAYMENT**: Customer payment confirmations
- **LOAN_DOCUMENT**: Loan agreements and payment schedules
- **INSURANCE_DOCUMENT**: Insurance policies and claims
- **UTILITY_BILL**: Utility bills and service charges

---

## Document Upload and Processing

### Upload Financial Document

Upload and process a financial document for an existing invoice. This initiates asynchronous processing.

```http
POST /api/financial-documents/upload/{invoice_id}
Content-Type: multipart/form-data
```

**Path Parameters:**
- `invoice_id` (string): ID of the associated invoice

**Form Parameters:**
- `document_type` (string): Type of document (see supported types below)
- `file` (file): The uploaded document file
- `force_regenerate` (boolean, default: false): Force regeneration of existing entries
- `custom_context` (string, optional): Additional context as JSON string

**Request Example:**
```bash
curl -X POST \
  /api/financial-documents/upload/INV-123 \
  -F "document_type=BANK_STATEMENT" \
  -F "file=@bank_statement_dec_2023.pdf" \
  -F "force_regenerate=false" \
  -F "custom_context={\"account_number\":\"12345678901\",\"statement_period\":\"2023-12\"}"
```

**Response:**
```json
{
  "success": true,
  "message": "Document uploaded and processing started",
  "task_id": "task-uuid-123",
  "invoice_id": "INV-123",
  "document_type": "BANK_STATEMENT",
  "file_path": "storage/financial_documents/INV-123_BANK_STATEMENT_unique-id.pdf",
  "upload_id": "upload-uuid-456"
}
```

**Document Type Values:**
- `BANK_STATEMENT`, `PAYROLL_DOCUMENT`, `EXPENSE_RECEIPT`
- `PURCHASE_ORDER`, `DELIVERY_NOTE`, `CONTRACT`
- `CREDIT_NOTE`, `DEBIT_NOTE`, `PAYMENT_VOUCHER`
- `TAX_DOCUMENT`, `CASH_RECEIPT`, `GOVERNMENT_DOCUMENT`
- `SUPPLIER_STATEMENT`, `CUSTOMER_PAYMENT`, `LOAN_DOCUMENT`
- `INSURANCE_DOCUMENT`, `UTILITY_BILL`, `OTHER`

### Process Financial Document (Synchronous)

Process a financial document synchronously for immediate results.

```http
POST /api/financial-documents/process
```

**Request Body:**
```json
{
  "file_path": "storage/financial_documents/document.pdf",
  "document_type": "BANK_STATEMENT",
  "invoice_id": "INV-123",
  "processing_options": {
    "extract_transactions": true,
    "generate_journal_entries": true,
    "account_mapping": true
  }
}
```

**Response:**
```json
{
  "success": true,
  "document_id": "doc-uuid-123",
  "processing_summary": {
    "document_type": "BANK_STATEMENT",
    "pages_processed": 3,
    "transactions_extracted": 45,
    "processing_time": 12.5
  },
  "journal_entries": [
    {
      "entry_id": "je-uuid-001",
      "reference": "VIR-2023-001",
      "date": "2023-12-01",
      "description": "Salary payment to employee",
      "lines": [
        {
          "account": "421000",
          "debit": 0,
          "credit": 3500.00,
          "description": "Employee salary"
        },
        {
          "account": "512000",
          "debit": 3500.00,
          "credit": 0,
          "description": "Bank account"
        }
      ]
    }
  ],
  "extracted_data": {
    "bank_info": {
      "bank_name": "Cr√©dit Agricole",
      "account_number": "12345678901",
      "iban": "FR76 1234 5678 9012 3456 789"
    },
    "statement_period": {
      "start_date": "2023-12-01",
      "end_date": "2023-12-31"
    },
    "transactions": [
      {
        "date": "2023-12-01",
        "description": "VIREMENT SALAIRE ENTREPRISE ABC",
        "amount": 3500.00,
        "type": "credit",
        "category": "salary_payment"
      }
    ]
  }
}
```

### Generate Intelligent Journal Entries

Generate intelligent journal entries for processed financial documents.

```http
POST /api/financial-documents/generate-journal
```

**Request Body:**
```json
{
  "invoice_id": "INV-123",
  "journal_type": "BANK_JOURNAL",
  "document_data": {
    "document_id": "doc-uuid-123",
    "document_type": "BANK_STATEMENT",
    "extracted_data": {
      "transactions": [
        {
          "date": "2023-12-01",
          "description": "Supplier payment",
          "amount": -1200.00,
          "type": "debit"
        }
      ]
    }
  },
  "generation_options": {
    "use_ai_categorization": true,
    "apply_pcg_mapping": true,
    "validate_accounts": true
  }
}
```

**Response:**
```json
{
  "success": true,
  "journal_entry_id": "je-uuid-456",
  "entry_reference": "BANK-2023-001",
  "journal_lines": [
    {
      "account": "401001",
      "account_name": "Fournisseurs",
      "debit": 1200.00,
      "credit": 0,
      "description": "Payment to supplier"
    },
    {
      "account": "512000",
      "account_name": "Banque",
      "debit": 0,
      "credit": 1200.00,
      "description": "Bank account decrease"
    }
  ],
  "llm_reasoning": "This transaction represents a payment to a supplier, debiting the supplier account and crediting the bank account according to French accounting standards.",
  "confidence_score": 0.94,
  "validation_results": {
    "balance_check": "passed",
    "account_validation": "passed",
    "pcg_compliance": "passed"
  }
}
```

---

## Document Management and Retrieval

### Get Invoice Documents

Retrieve all financial documents associated with an invoice.

```http
GET /api/financial-documents/invoice/{invoice_id}/documents
```

**Response:**
```json
{
  "invoice_id": "INV-123",
  "document_uploads": [
    {
      "upload_id": "upload-uuid-456",
      "document_id": "doc-uuid-123",
      "document_type": "BANK_STATEMENT",
      "original_filename": "bank_statement_dec_2023.pdf",
      "file_path": "storage/financial_documents/INV-123_BANK_STATEMENT_unique-id.pdf",
      "file_size": 245760,
      "status": "completed",
      "uploaded_at": "2023-12-01T10:30:00Z",
      "task_id": "task-uuid-123"
    }
  ],
  "processed_documents": [
    {
      "document_id": "doc-uuid-123",
      "processing_summary": {
        "pages_processed": 3,
        "transactions_extracted": 45,
        "processing_time": 12.5
      },
      "created_at": "2023-12-01T10:35:00Z"
    }
  ],
  "journal_entries": [
    {
      "journal_entry_id": "je-uuid-456",
      "entry_reference": "BANK-2023-001",
      "journal_type": "BANK_JOURNAL",
      "created_at": "2023-12-01T10:36:00Z"
    }
  ],
  "summary": {
    "total_uploads": 1,
    "total_processed": 1,
    "total_journal_entries": 1
  }
}
```

### Get Document Details

Get detailed information about a specific processed document.

```http
GET /api/financial-documents/document/{document_id}
```

**Response:**
```json
{
  "document_id": "doc-uuid-123",
  "invoice_id": "INV-123",
  "document_type": "BANK_STATEMENT",
  "file_path": "storage/financial_documents/INV-123_BANK_STATEMENT_unique-id.pdf",
  "processing_summary": {
    "pages_processed": 3,
    "transactions_extracted": 45,
    "processing_time": 12.5,
    "confidence_score": 0.92
  },
  "journal_entries": [
    {
      "entry_id": "je-uuid-001",
      "reference": "BANK-2023-001",
      "lines": [...]
    }
  ],
  "extracted_data": {
    "bank_info": {...},
    "transactions": [...]
  },
  "created_at": "2023-12-01T10:35:00Z"
}
```

### Delete Document

Delete a processed document and its associated files.

```http
DELETE /api/financial-documents/document/{document_id}
```

**Response:**
```json
{
  "success": true,
  "message": "Document doc-uuid-123 deleted successfully",
  "document_id": "doc-uuid-123"
}
```

---

## Task Management and Monitoring

### Get Task Status

Monitor the status of a financial document processing task.

```http
GET /api/financial-documents/task/{task_id}/status
```

**Response:**
```json
{
  "task_id": "task-uuid-123",
  "status": "completed",
  "progress": 100,
  "started_at": "2023-12-01T10:30:15Z",
  "completed_at": "2023-12-01T10:30:45Z",
  "processing_time": 30.2,
  "result": {
    "success": true,
    "document_id": "doc-uuid-123",
    "transactions_processed": 45,
    "journal_entries_created": 45
  },
  "error": null,
  "worker_info": {
    "worker_id": "worker-001",
    "queue_name": "financial_document_processing"
  }
}
```

**Task Status Values:**
- `pending`: Task queued but not started
- `processing`: Task currently being processed
- `completed`: Task completed successfully
- `failed`: Task failed with error
- `cancelled`: Task was cancelled

---

## Specialized Document Processing

### Get Financial Document Journal

Retrieve journal entries for a specific document type and invoice.

```http
GET /api/financial-documents/journal/{invoice_id}?document_type=BANK_STATEMENT
```

**Query Parameters:**
- `document_type` (string): Type of document to get journal entries for

**Response:**
```json
{
  "success": true,
  "message": "Found 45 journal entries",
  "journal_entries": [
    {
      "journal_entry_id": "je-uuid-001",
      "entry_reference": "BANK-2023-001", 
      "date": "2023-12-01",
      "description": "Bank statement transaction",
      "lines": [
        {
          "account": "512000",
          "account_name": "Banque",
          "debit": 1200.00,
          "credit": 0,
          "description": "Bank credit"
        },
        {
          "account": "706000", 
          "account_name": "Prestations de services",
          "debit": 0,
          "credit": 1200.00,
          "description": "Service revenue"
        }
      ],
      "confidence_score": 0.95,
      "created_at": "2023-12-01T10:36:00Z"
    }
  ],
  "invoice_id": "INV-123",
  "document_type": "BANK_STATEMENT"
}
```

### Get Supported Document Types

Get complete list of supported document types and their configurations.

```http
GET /api/financial-documents/types
```

**Response:**
```json
{
  "supported_types": {
    "BANK_STATEMENT": {
      "name": "Bank Statement",
      "description": "Bank account statements with transaction details",
      "journal_type": "BANK_JOURNAL",
      "auto_generate_journal": true
    },
    "PAYROLL_DOCUMENT": {
      "name": "Payroll Document", 
      "description": "Employee payroll and salary documents",
      "journal_type": "OPERATIONS_JOURNAL",
      "auto_generate_journal": true
    },
    "EXPENSE_RECEIPT": {
      "name": "Expense Receipt",
      "description": "Employee expense receipts and reimbursements", 
      "journal_type": "OPERATIONS_JOURNAL",
      "auto_generate_journal": true
    },
    "PURCHASE_ORDER": {
      "name": "Purchase Order",
      "description": "Purchase orders and procurement documents",
      "journal_type": "PURCHASE_JOURNAL", 
      "auto_generate_journal": true
    },
    "CONTRACT": {
      "name": "Contract",
      "description": "Service contracts and agreements",
      "journal_type": "OPERATIONS_JOURNAL",
      "auto_generate_journal": false
    }
  },
  "total_types": 18
}
```

---

## Specialized Processing Workflows

### Bank Statement Processing

Bank statements receive specialized processing including:

**Transaction Extraction:**
- Automatic transaction detection and categorization
- Balance reconciliation and validation
- Merchant/vendor identification
- Payment method classification

**Account Mapping:**
- Automatic PCG account assignment
- Transaction type recognition (salary, supplier payments, etc.)
- VAT calculation where applicable
- Multi-currency support

**Journal Generation:**
- French accounting standard compliance
- Double-entry bookkeeping validation
- Automated account suggestions
- Confidence scoring for each entry

**Custom Context Options:**
```json
{
  "account_number": "12345678901",
  "statement_period": "2023-12",
  "bank_code": "CREDIT_AGRICOLE",
  "auto_categorize": true
}
```

### Payroll Document Processing

Payroll documents include specialized handling for:

**Employee Data Extraction:**
- Employee identification and matching
- Salary components breakdown
- Social charges and contributions
- Tax withholdings and deductions

**Account Classification:**
- Salary expense accounts (641xxx)
- Social charge accounts (645xxx)
- Tax liability accounts (437xxx)
- Bank payment accounts (512xxx)

**Custom Context Options:**
```json
{
  "employee_id": "EMP-123",
  "pay_period": "2023-12",
  "department": "SALES",
  "salary_type": "MONTHLY"
}
```

### Expense Receipt Processing

Expense receipts receive specialized processing for:

**Expense Categorization:**
- Automatic expense type detection
- VAT recovery calculations
- Reimbursement tracking
- Policy compliance checking

**Account Mapping:**
- Expense category accounts (6xxxx)
- VAT recovery accounts (44566x)
- Employee advance accounts (425xxx)
- Reimbursement liability accounts

**Custom Context Options:**
```json
{
  "expense_category": "MEALS",
  "employee_id": "EMP-123", 
  "reimbursable": true,
  "business_purpose": "Client meeting"
}
```

---

## Error Handling

### Common Error Responses

```json
// Invalid document type
{
  "detail": "Invalid document type: INVALID_TYPE"
}

// File not found
{
  "detail": "File not found: /path/to/file.pdf"
}

// Processing error
{
  "detail": "Error processing document: OCR extraction failed"
}

// Invoice not found
{
  "detail": "Invoice INV-123 not found"
}

// Task not found
{
  "detail": "Task task-uuid-123 not found"
}
```

### Status Codes

- `200`: Successful operation
- `400`: Bad request (invalid parameters, file format)
- `404`: Resource not found (invoice, document, task)
- `500`: Internal server error (processing failure)

---

## Integration with Task System

### Message Queue Architecture

The Financial Documents API uses RabbitMQ for reliable task processing:

**Task Types:**
- `FinancialDocumentProcessingMessage`: Generic document processing
- `BankStatementProcessingMessage`: Bank statement specific processing
- `PayrollProcessingMessage`: Payroll document processing
- `ExpenseReceiptProcessingMessage`: Expense receipt processing

**Task Priorities:**
- `HIGH`: Bank statements, payroll documents
- `NORMAL`: Expense receipts, purchase orders
- `LOW`: Contracts, tax documents

**Queue Configuration:**
- Dead letter queues for failed tasks
- Retry mechanisms with exponential backoff
- Task timeout and monitoring
- Worker load balancing

### Database Integration

Financial document processing integrates with MongoDB collections:

**Storage Collections:**
- `document_uploads`: Upload metadata and status
- `processed_documents`: Processing results and extracted data
- `journal_entries`: Generated accounting entries
- `task_status`: Task execution monitoring

**Data Flow:**
1. Document upload ‚Üí `document_uploads` collection
2. Task creation ‚Üí Message queue
3. Processing results ‚Üí `processed_documents` collection
4. Journal generation ‚Üí `journal_entries` collection
5. Status updates ‚Üí `task_status` collection

---