---
title: "Conversations API Reference"
description: "Complete API reference for Textra's multi-conversation AI chat system with specialized accounting agents"
---

The Conversations API powers Textra's sophisticated multi-conversation chat interface, enabling users to maintain multiple simultaneous conversations with specialized AI agents. The system provides intelligent conversation management, context preservation, real-time streaming responses, and seamless integration with the accounting automation pipeline.

## System Architecture

### Multi-Agent Chat System

The Conversations API is built around an **Agno-based AI architecture** with specialized agents:

- **MongoDB Agent**: Direct database queries and analytics through MCP tools
- **Calculation Agent**: Financial calculations and analysis
- **Retrieval Agent**: Database search and document discovery

### Key Features

- **User-Scoped Conversations**: All endpoints are user-specific for security and organization
- **Context Preservation**: MongoDB-based memory and conversation history
- **Real-Time Streaming**: Server-sent events for live message delivery
- **File Integration**: PDF upload and knowledge base integration for RAG
- **Agent Memory**: Persistent agent memory across conversations

---
## Agent Integration

The conversation system integrates with Agno agents providing:

**Agent Configuration:**
- **Model**: Gemini 2.0 Flash for intelligent responses
- **Memory**: MongoDB-based persistent memory across conversations
- **Storage**: MongoDB storage for session management
- **Tools**: MCP (Model Context Protocol) tools for database access

**Agent Capabilities:**
- **Agentic Memory**: Intelligent memory management across sessions
- **Session Summaries**: Automatic conversation summarization
- **Knowledge Base**: PDF document integration for RAG responses
- **Database Access**: Direct MongoDB querying through MCP tools

**Knowledge Base Features:**
- **Vector Storage**: ChromaDB with conversation-specific collections
- **Embeddings**: Ollama mxbai-embed-large for semantic search
- **Document Processing**: Automatic PDF processing and indexing
- **Context Integration**: Documents are accessible during agent responses

---

## Core Conversation Management

### Create New Conversation

Create a new conversation for a specific user.

```http
POST /users/{user_id}/conversations
```

**Path Parameters:**
- `user_id` (string): Unique identifier for the user

**Request Body:**
```json
{
  "title": "Invoice Analysis - December 2023"
}
```

**Response:**
```json
{
  "conversation_id": "conv-uuid-here",
  "status": "created"
}
```

### List User Conversations

Retrieve all conversations for a user with filtering and pagination.

```http
GET /users/{user_id}/conversations
```

**Path Parameters:**
- `user_id` (string): Unique identifier for the user

**Query Parameters:**
- `include_archived` (boolean, default: false): Include archived conversations
- `limit` (integer, default: 50, max: 100): Maximum number of conversations to return
- `offset` (integer, default: 0): Number of conversations to skip

**Response:**
```json
[
  {
    "id": "conv-uuid-1",
    "user_id": "user-123",
    "title": "Invoice Analysis - December 2023",
    "message_count": 15,
    "created_at": "2023-12-01T10:30:00Z",
    "updated_at": "2023-12-01T15:45:00Z",
    "is_archived": false,
    "last_message_preview": "The total VAT amount for these invoices is â‚¬2,400.00"
  }
]
```

### Search Conversations

Search conversations by title and content for a specific user.

```http
GET /users/{user_id}/conversations/search
```

**Path Parameters:**
- `user_id` (string): Unique identifier for the user

**Query Parameters:**
- `q` (string, required): Search query
- `limit` (integer, default: 20, max: 50): Maximum number of results
- `offset` (integer, default: 0): Number of results to skip

**Response:**
```json
[
  {
    "id": "conv-uuid-1",
    "user_id": "user-123",
    "title": "Invoice Analysis - December 2023",
    "message_count": 15,
    "created_at": "2023-12-01T10:30:00Z",
    "updated_at": "2023-12-01T15:45:00Z",
    "is_archived": false,
    "last_message_preview": "Found 8 invoices matching your criteria..."
  }
]
```

### Get User Statistics

Get conversation statistics for a user.

```http
GET /users/{user_id}/conversations/stats
```

**Response:**
```json
{
  "total_conversations": 25,
  "active_conversations": 20,
  "archived_conversations": 5,
  "total_messages": 847,
  "avg_messages_per_conversation": 33.9,
  "last_activity": "2023-12-01T15:45:00Z"
}
```

### Get Single Conversation

Retrieve complete conversation details including message history.

```http
GET /users/{user_id}/conversations/{conversation_id}
```

**Path Parameters:**
- `user_id` (string): Unique identifier for the user
- `conversation_id` (string): Unique identifier for the conversation

**Query Parameters:**
- `bypass_cache` (boolean, default: false): Bypass cache and fetch fresh data

**Response:**
```json
{
  "id": "conv-uuid-1",
  "user_id": "user-123",
  "title": "Invoice Analysis - December 2023",
  "messages": [
    {
      "id": "msg-uuid-1",
      "role": "user",
      "content": "Please analyze the VAT amounts in these invoices",
      "created_at": "2023-12-01T15:40:00Z"
    },
    {
      "id": "msg-uuid-2",
      "role": "assistant", 
      "content": "I'll analyze the VAT amounts in the invoices you've referenced. Let me examine each one...",
      "created_at": "2023-12-01T15:45:00Z"
    }
  ],
  "created_at": "2023-12-01T10:30:00Z",
  "updated_at": "2023-12-01T15:45:00Z",
  "is_archived": false,
  "metadata": {},
  "file_paths": [
    "storage/uploads/conversations/conv-uuid-1/invoice_batch.pdf"
  ]
}
```

### Update Conversation Title

Update the title of a conversation.

```http
PUT /users/{user_id}/conversations/{conversation_id}/title
```

**Request Body:**
```json
{
  "title": "Updated Invoice Analysis - Q4 2023"
}
```

**Response:**
```json
{
  "status": "updated",
  "title": "Updated Invoice Analysis - Q4 2023"
}
```

### Archive Conversation

Archive a conversation (moves it out of active list).

```http
POST /users/{user_id}/conversations/{conversation_id}/archive
```

**Response:**
```json
{
  "id": "conv-uuid-1",
  "user_id": "user-123",
  "title": "Invoice Analysis - December 2023",
  "messages": [...],
  "created_at": "2023-12-01T10:30:00Z",
  "updated_at": "2023-12-01T16:00:00Z",
  "is_archived": true,
  "metadata": {}
}
```

### Unarchive Conversation

Restore an archived conversation to active status.

```http
DELETE /users/{user_id}/conversations/{conversation_id}/archive
```

**Response:**
```json
{
  "id": "conv-uuid-1",
  "user_id": "user-123",
  "title": "Invoice Analysis - December 2023",
  "messages": [...],
  "created_at": "2023-12-01T10:30:00Z",
  "updated_at": "2023-12-01T16:05:00Z",
  "is_archived": false,
  "metadata": {}
}
```

### Delete Conversation

Permanently delete a conversation and all its messages.

```http
DELETE /users/{user_id}/conversations/{conversation_id}
```

**Response:**
```json
{
  "message": "Conversation deleted successfully",
  "status": "deleted"
}
```

---

## Message Management

### Add Message to Conversation

Add a new message to an existing conversation.

```http
POST /users/{user_id}/conversations/{conversation_id}/messages
```

**Request Body:**
```json
{
  "role": "user",
  "content": "What is the total amount for all invoices this month?"
}
```

**Response:**
```json
{
  "message_id": "msg-uuid-123",
  "status": "added"
}
```

### Get Conversation Messages

Retrieve messages for a conversation with pagination.

```http
GET /users/{user_id}/conversations/{conversation_id}/messages
```

**Query Parameters:**
- `limit` (integer, default: 50, max: 100): Maximum number of messages to return
- `before_message_id` (string, optional): Get messages before this message ID

**Response:**
```json
[
  {
    "id": "msg-uuid-1",
    "role": "user",
    "content": "Please analyze the VAT amounts in these invoices",
    "created_at": "2023-12-01T15:40:00Z"
  },
  {
    "id": "msg-uuid-2",
    "role": "assistant",
    "content": "I'll analyze the VAT amounts in the invoices you've referenced...",
    "created_at": "2023-12-01T15:45:00Z"
  }
]
```

---

## Real-Time Streaming

### Stream Chat Response

Stream a real-time AI response to a user message.

```http
POST /users/{user_id}/conversations/{conversation_id}/stream
```

**Request Body:**
```json
{
  "role": "user",
  "content": "Calculate the total VAT for all invoices from supplier ABC"
}
```

**Response (Server-Sent Events):**
```
data: {"chunk": "I'll ", "conversation_id": "conv-uuid-1"}

data: {"chunk": "calculate ", "conversation_id": "conv-uuid-1"}

data: {"chunk": "the total VAT ", "conversation_id": "conv-uuid-1"}

data: {"chunk": "for supplier ABC. ", "conversation_id": "conv-uuid-1"}

data: {"chunk": "[DONE]", "conversation_id": "conv-uuid-1"}
```

**Response Headers:**
- `Content-Type: text/event-stream`
- `Cache-Control: no-cache`
- `Connection: keep-alive`

### Legacy Streaming Endpoint

Alternative streaming endpoint that supports both conversation-based and session-based interactions.

```http
POST /users/{user_id}/stream_id_chat
```

**Request Body:**
```json
{
  "message": "Show me all unpaid invoices",
  "user_id": "user-123",
  "session_id": "session-uuid-456",
  "conversation_id": "conv-uuid-789"
}
```

**Response (Server-Sent Events):**
```
data: {"chunk": "Here are ", "session_id": "session-uuid-456", "conversation_id": "conv-uuid-789"}

data: {"chunk": "all unpaid invoices: ", "session_id": "session-uuid-456", "conversation_id": "conv-uuid-789"}
```

---

## File Management and RAG Integration

### Upload File to Conversation

Upload a PDF file to a conversation for RAG (Retrieval-Augmented Generation) functionality.

```http
POST /users/{user_id}/conversations/{conversation_id}/files
```

**Request Body (multipart/form-data):**
- `file` (file, required): PDF file to upload

**Response:**
```json
{
  "status": "success",
  "file_path": "storage/uploads/conversations/conv-uuid-1/document.pdf",
  "filename": "document.pdf",
  "message": "File uploaded successfully and conversation updated"
}
```

**File Processing:**
- Files are stored in `storage/uploads/conversations/{conversation_id}/`
- PDF files are automatically processed for RAG capabilities
- Conversation agents can access uploaded documents for context-aware responses
- ChromaDB vector store is created for document embeddings
- Ollama embedder (mxbai-embed-large) is used for text embedding

---

## Conversation Enhancement

### Auto-Generate Conversation Title

Automatically generate a descriptive title based on conversation content.

```http
POST /users/{user_id}/conversations/{conversation_id}/auto-title
```

**Response:**
```json
{
  "status": "title_generation_started"
}
```

*Note: This operation runs in the background and updates the conversation title asynchronously.*

### Get Conversation Summary

Generate a summary of the conversation content.

```http
GET /users/{user_id}/conversations/{conversation_id}/summary
```

**Response:**
```json
{
  "conversation_id": "conv-uuid-1",
  "summary": "User discussed VAT analysis for December 2023 invoices, focusing on supplier ABC. AI agent calculated total VAT amounts and identified potential discrepancies.",
  "key_topics": ["VAT analysis", "invoice review", "supplier ABC"],
  "message_count": 15,
  "generated_at": "2023-12-01T16:00:00Z"
}
```

## Health Check

### Conversation Service Health

Check the health status of the conversation service.

```http
GET /conversations/health
```

**Response:**
```json
{
  "status": "healthy",
  "service": "conversation_api",
  "timestamp": "2023-12-01T10:30:00Z"
}
```

---

## Data Models

### Conversation Response Model

```typescript
interface ConversationResponse {
  id: string;
  user_id: string;
  title: string;
  message_count: number;
  created_at: string;
  updated_at: string;
  is_archived: boolean;
  last_message_preview?: string;
}
```

### Conversation Detail Response Model

```typescript
interface ConversationDetailResponse {
  id: string;
  user_id: string;
  title: string;
  messages: Message[];
  created_at: string;
  updated_at: string;
  is_archived: boolean;
  metadata: Record<string, any>;
  file_paths: string[];
}
```

### Message Model

```typescript
interface Message {
  id: string;
  role: "user" | "assistant";
  content: string;
  created_at: string;
}
```

---

## Error Handling

### Common Error Responses

```json
// Conversation not found
{
  "detail": "Conversation not found"
}

// Permission denied
{
  "detail": "Failed to get conversation: Access denied"
}

// Validation error
{
  "detail": "Failed to create conversation: Title cannot be empty"
}

// File upload error
{
  "detail": "Only PDF files are supported"
}
```

### Status Codes

- `200`: Successful operation
- `400`: Bad request (validation errors)
- `404`: Resource not found (conversation, user)
- `500`: Internal server error

---





