---
title: "Conversation Service"
description: "Multi-conversation chat system with AI integration and intelligent conversation management"
---

The Conversation Service powers Textra's sophisticated multi-conversation chat interface, enabling users to maintain multiple simultaneous conversations with AI agents while providing intelligent conversation management, context preservation, and seamless integration with the accounting automation pipeline.

## Service Architecture

### Multi-Conversation Management

Unlike traditional single-chat interfaces, Textra's Conversation Service is designed around the concept of **parallel conversation threads**. This architecture recognizes that users often need to:

- **Work on Multiple Invoices**: Discuss different invoices simultaneously without losing context
- **Compare and Analyze**: Have side-by-side conversations about related financial documents  
- **Delegate and Collaborate**: Share specific conversations with team members
- **Maintain Context**: Keep conversation history for audit trails and future reference

### Intelligent Context Preservation

Each conversation maintains its own **contextual memory** that includes:

**Document Context**: Which invoices, reports, or financial documents are being discussed
**Processing State**: Current status of any accounting operations initiated through chat
**User Preferences**: Learned preferences for how the user likes information presented
**Conversation History**: Complete message history with metadata and timestamps

---

## Core Functionality

### Conversation Lifecycle Management

#### Conversation Creation and Initialization

When a new conversation is created, the service automatically:

**Assigns Unique Identifiers**: Each conversation gets a globally unique ID for tracking and reference
**Initializes Context**: Sets up the conversation context based on the user's current activity
**Configures AI Agents**: Determines which AI agents should be available based on user permissions and conversation type
**Establishes Caching**: Sets up conversation-specific caching for performance optimization

#### Dynamic Title Generation

The service includes **intelligent title generation** that automatically creates meaningful conversation titles based on content:

**Content Analysis**: Analyzes the first few messages to understand the conversation topic
**Document Integration**: When discussing specific invoices or reports, titles include relevant identifiers
**User Customization**: Users can override auto-generated titles with custom names
**Historical Context**: Titles are updated as conversations evolve to remain relevant

### Message Management and Processing

#### Message Streaming and Real-Time Updates

The service implements **real-time message streaming** for responsive user experiences:

**Incremental Delivery**: Long AI responses are delivered in chunks as they're generated
**Typing Indicators**: Users see when AI agents are processing and generating responses
**Progress Tracking**: For operations that trigger accounting processes, users see real-time progress
**Error Handling**: Failed message delivery is handled gracefully with retry mechanisms

#### Message Metadata and Enrichment

Every message in the system is enhanced with comprehensive metadata:

**Timestamp Precision**: Exact timestamps for audit trails and synchronization
**User Attribution**: Clear identification of human vs AI messages with agent types
**Processing Context**: Links to any accounting operations triggered by the message
**Confidence Scores**: For AI responses, confidence levels and reasoning chains
**Document References**: Automatic linking to discussed invoices, reports, or documents

### Advanced Conversation Features

#### Conversation Archiving and Organization

The service provides sophisticated organization tools:

**Smart Archiving**: Conversations are automatically suggested for archiving based on inactivity and completion status
**Search and Discovery**: Full-text search across all conversations with intelligent ranking
**Categorization**: Automatic categorization based on conversation content and context
**Export Capabilities**: Complete conversation exports for compliance and record-keeping

#### Context Switching and Conversation Linking

Users can seamlessly switch between conversations while maintaining context:

**Quick Switching**: Rapid navigation between active conversations without losing state
**Cross-Conversation References**: Ability to reference information from other conversations
**Conversation Merging**: Combine related conversations when needed
**Context Inheritance**: New conversations can inherit context from existing ones

---

## AI Agent Integration

### Multi-Agent Architecture

The Conversation Service integrates with Textra's **team of specialized AI agents**:

#### Invoice QA Agent  
**Specialization**: Answering detailed questions about invoice content using RAG (Retrieval-Augmented Generation)
**Integration**: Provides accurate, source-backed answers about specific invoice details
**Capabilities**: Can analyze line items, pricing, dates, and terms with high accuracy

#### Calculation Agent
**Specialization**: Performing financial calculations and analysis on invoice data
**Integration**: Handles complex calculations and provides detailed breakdowns
**Capabilities**: VAT calculations, total verification, currency conversions

#### MongoDB Agent
**Specialization**: Direct database queries and data analysis
**Integration**: Provides database insights and complex analytical queries
**Capabilities**: Aggregation queries, statistical analysis, and data mining operations


---

## Data Persistence and Reliability

### MongoDB Integration

Conversations are stored in MongoDB with a sophisticated schema design:

**Document Structure**: Each conversation is a document with embedded message arrays
**Indexing Strategy**: Optimized indexes for fast conversation retrieval and search
**Scalability Design**: Schema designed to handle millions of conversations efficiently
**Backup Integration**: Conversation data is included in system backup procedures

