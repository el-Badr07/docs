---
title: "Accounting Models"
description: "Pydantic models for the accounting automation pipeline with French PCG compliance and comprehensive financial data structures"
---

The Accounting Models define the core data structures for Textra's accounting automation system, providing sophisticated Pydantic-based models that ensure data integrity, validation, and seamless integration throughout the 5-phase processing pipeline. These models are designed with French accounting standards (PCG) compliance while supporting comprehensive financial document processing.

## Core Enumerations

### InvoiceType

```python
class InvoiceType(str, Enum):
    PURCHASE = "purchase"
    SALE = "sale"
    UNKNOWN = "unknown"
```

**Invoice Classification:**
- **PURCHASE**: Purchase invoices (factures d'achat) from suppliers
- **SALE**: Sales invoices (factures de vente) to customers  
- **UNKNOWN**: Unclassified invoices requiring manual review

### ProcessingStatus

```python
class ProcessingStatus(str, Enum):
    PENDING = "pending"
    EXTRACTING = "extracting"
    EXTRACTED = "extracted"
    IMPUTING = "imputing"
    IMPUTED = "imputed"
    GENERATING = "generating"
    GENERATED = "generated"
    EXPORTING = "exporting"
    EXPORTED = "exported"
    COMPLETED = "completed"
    FAILED = "failed"
```

**Pipeline Status Tracking:**
- Comprehensive status tracking through all 5 phases
- Real-time progress monitoring
- Error state handling and recovery

### DocumentType

```python
class DocumentType(str, Enum):
    INVOICE = "invoice"
    PURCHASE_INVOICE = "purchase_invoice"
    SALE_INVOICE = "sale_invoice"
    BANK_STATEMENT = "bank_statement"
    PAYROLL_DOCUMENT = "payroll_document"
    EXPENSE_RECEIPT = "expense_receipt"
    CONTRACT = "contract"
    PURCHASE_ORDER = "purchase_order"
    DELIVERY_NOTE = "delivery_note"
    CREDIT_NOTE = "credit_note"
    DEBIT_NOTE = "debit_note"
    PAYMENT_VOUCHER = "payment_voucher"
    TAX_DOCUMENT = "tax_document"
    CASH_RECEIPT = "cash_receipt"
    GOVERNMENT_DOCUMENT = "government_document"
    SUPPLIER_STATEMENT = "supplier_statement"
    CUSTOMER_PAYMENT = "customer_payment"
    LOAN_DOCUMENT = "loan_document"
    INSURANCE_DOCUMENT = "insurance_document"
    UTILITY_BILL = "utility_bill"
    GENERIC_DOCUMENT = "generic_document"
    OTHER = "other"
```

**Comprehensive Document Support:**
- Core invoice types for standard processing
- Extended financial document types for complete accounting coverage
- Specialized document types for different business workflows

## Core Data Models

### ExtractedInvoice

```python
class ExtractedInvoice(BaseModel):
    invoice_id: str = Field(..., description="Unique invoice identifier")
    file_path: str = Field(..., description="Path to original invoice file")
    
    # Invoice classification
    invoice_type: InvoiceType = Field(..., description="Purchase or sale invoice")
    
    # Basic invoice metadata
    invoice_number: str = Field(..., description="Invoice number")
    invoice_date: str = Field(..., description="Invoice date (YYYY-MM-DD)")
    due_date: Optional[str] = Field(None, description="Payment due date (YYYY-MM-DD)")
    
    # Parties information
    vendor_name: Optional[str] = Field(None, description="Vendor name for purchases")
    vendor_address: Optional[str] = Field(None, description="Vendor address")
    customer_name: Optional[str] = Field(None, description="Customer name for sales")
    customer_address: Optional[str] = Field(None, description="Customer address")
    
    # Financial totals
    total_amount_ht: float = Field(..., ge=0, description="Total amount excluding VAT")
    total_amount_ttc: float = Field(..., ge=0, description="Total amount including VAT")
    currency: str = Field(default="EUR", description="Currency code")
    
    # VAT information
    vat_details: List[VATDetail] = Field(default_factory=list, description="VAT breakdown by rate")
    
    # Line items
    line_items: List[LineItem] = Field(default_factory=list, description="Individual line items")
    
    # Payment Status Information (Manual Entry - Phase 2 Feature)
    payment_status: Optional[str] = Field(None, description="Payment status: unpaid, paid, partially_paid, overdue")
    payment_method: Optional[str] = Field(None, description="Payment method: bank_transfer, check, cash, credit_card, direct_debit")
    payment_date: Optional[str] = Field(None, description="Payment date (YYYY-MM-DD)")
    paid_amount: Optional[float] = Field(None, ge=0, description="Amount paid (for partial payments)")
    payment_reference: Optional[str] = Field(None, description="Payment reference/transaction ID")
    payment_notes: Optional[str] = Field(None, description="Additional payment notes")
    
    # Financial Journal Entry (Generated after payment info)
    financial_journal_entry: Optional[Dict[str, Any]] = Field(None, description="Financial journal entry for payment")
    
    # Processing metadata
    extraction_confidence: float = Field(..., ge=0, le=1, description="Overall extraction confidence")
    extracted_at: datetime = Field(default_factory=datetime.now, description="Extraction timestamp")
    processing_language: str = Field(default="fr", description="Detected invoice language")
    status: Optional[ProcessingStatus] = Field(default=ProcessingStatus.EXTRACTED, description="Processing status")
```

**Complete Invoice Data Structure:**

The ExtractedInvoice model captures the complete structured data from Phase 1 extraction, including:

- **Invoice Classification**: Automatic detection of purchase vs. sale invoices
- **Metadata**: Invoice numbers, dates, parties (vendors/customers)
- **Financial Data**: HT/TTC amounts, VAT details, line items with full detail
- **Payment Tracking**: Comprehensive payment status and method tracking
- **Quality Metrics**: Extraction confidence scoring and language detection
- **Status Tracking**: Current processing status within the pipeline

### VATDetail

```python
class VATDetail(BaseModel):
    rate: float = Field(..., ge=0, le=100, description="VAT rate as percentage")
    amount: float = Field(..., ge=0, description="VAT amount")
```

**VAT Breakdown Structure:**
- Supports multiple VAT rates per invoice
- French VAT rates: 20%, 10%, 5.5%, 0%
- Automatic validation of VAT calculations

### LineItem

```python
class LineItem(BaseModel):
    description: str = Field(..., description="Item/service description")
    quantity: float = Field(default=1.0, ge=0, description="Quantity")
    unit_price: float = Field(..., ge=0, description="Unit price excluding VAT")
    line_amount_ht: float = Field(..., ge=0, description="Line amount excluding VAT")
    line_vat_rate: float = Field(..., ge=0, le=100, description="VAT rate for this line")
    line_vat_amount: float = Field(..., ge=0, description="VAT amount for this line")
    product_code: Optional[str] = Field(None, description="Product code if available")
    category: Optional[str] = Field(None, description="Item category")
    notes: Optional[str] = Field(None, description="Additional notes")
```

**Detailed Line Item Tracking:**
- Complete financial breakdown per line
- Product/service categorization for account mapping
- Individual VAT handling per line item

### AccountingProposals

```python
class AccountingProposals(BaseModel):
    invoice_id: str = Field(..., description="Reference to extracted invoice")
    invoice_type: InvoiceType = Field(..., description="Purchase or sale invoice")
    
    # Tiers account proposal
    tiers_proposal: TiersProposal = Field(..., description="Proposed tiers account")
    
    # Line item proposals
    line_item_proposals: List[LineItemProposal] = Field(..., description="Proposals for each line item")
    
    # Overall confidence
    overall_confidence: float = Field(..., ge=0, le=1, description="Overall imputation confidence")
    
    # Processing metadata
    imputed_at: datetime = Field(default_factory=datetime.now, description="Imputation timestamp")
    status: Optional[ProcessingStatus] = Field(default=ProcessingStatus.IMPUTED, description="Processing status")
    error_message: Optional[str] = Field(None, description="Error message if any")
```

### AccountProposal

```python
class AccountProposal(BaseModel):
    account_number: str = Field(..., description="PCG account number")
    account_title: str = Field(..., description="PCG account title")
    confidence: float = Field(..., ge=0, le=1, description="Confidence score for this mapping")
    reasoning: Optional[str] = Field(None, description="LLM reasoning for this choice")
```

### TiersProposal

```python
class TiersProposal(BaseModel):
    party_name: str = Field(..., description="Vendor or customer name")
    party_type: str = Field(..., description="vendor or customer")
    proposed_account: AccountProposal = Field(..., description="Proposed tiers account (401xxx/411xxx)")
```

**Tiers Account Mapping:**
- **401xxx series**: Supplier accounts (Fournisseurs) for purchase invoices
- **411xxx series**: Customer accounts (Clients) for sales invoices
- **Confidence-based proposals**: LLM reasoning and confidence scoring
- **Automatic account generation**: New vendor/customer account creation

### LineItemProposal

```python
class LineItemProposal(BaseModel):
    line_index: int = Field(..., description="Index of line item in original invoice")
    line_description: str = Field(..., description="Original line description")
    line_amount_ht: float = Field(..., description="Line amount excluding VAT")
    
    # Proposed accounts
    charge_product_account: AccountProposal = Field(..., description="Proposed charge/product account (6xx/7xx/2xx)")
    vat_account: AccountProposal = Field(..., description="Proposed VAT account (4456x/4457x)")
    
    # VAT information
    vat_rate: float = Field(..., description="VAT rate for this line")
    vat_amount: float = Field(..., description="VAT amount for this line")
```

**Intelligent Line Item Mapping:**
- **6xx series**: Expense accounts for purchases (achats, charges)
- **7xx series**: Revenue accounts for sales (ventes, produits)
- **2xx series**: Asset accounts for capital purchases
- **4456x/4457x**: VAT accounts based on transaction type and rates
- **LLM-powered categorization**: AI-driven account suggestions with reasoning

### ImprovedFinalAccountingEntry

```python
class ImprovedFinalAccountingEntry(BaseModel):
    invoice_id: str = Field(..., description="Reference to extracted invoice")
    entry_id: Optional[str] = Field(None, description="Unique journal entry identifier")
    
    # Related data
    original_invoice: Optional["ExtractedInvoice"] = Field(None, description="Original extracted invoice")
    accounting_proposals: Optional["AccountingProposals"] = Field(None, description="Accounting proposals")
    
    # Entry metadata (all at top level)
    entry_date: str = Field(..., description="Journal entry date (YYYY-MM-DD)")
    entry_reference: str = Field(..., description="Journal entry reference")
    entry_description: str = Field(..., description="Overall entry description")
    journal_type: str = Field(..., description="Journal type (purchase/sale/credit_note)")
    due_date_calculated: Optional[str] = Field(None, description="Calculated due date (YYYY-MM-DD)")
    
    # Journal entry lines (single consolidated array)
    entry_lines: List[EnhancedJournalEntryLine] = Field(..., description="All journal entry lines")
    
    # Processing status
    status: ProcessingStatus = Field(default=ProcessingStatus.COMPLETED, description="Processing status")
    error_message: Optional[str] = Field(None, description="Error message if any")
    
    # Balance validation
    total_debit: float = Field(..., ge=0, description="Total debit amount")
    total_credit: float = Field(..., ge=0, description="Total credit amount")
    is_balanced: bool = Field(..., description="Whether entry is balanced")
    balance_difference: float = Field(default=0.0, description="Difference if unbalanced")
    
    # Processing metadata
    overall_confidence: float = Field(..., ge=0, le=1, description="Overall entry confidence from proposals")
    generated_at: datetime = Field(default_factory=datetime.now, description="Generation timestamp")
    created_at: datetime = Field(default_factory=datetime.now, description="Creation timestamp")
    updated_at: datetime = Field(default_factory=datetime.now, description="Last update timestamp")
```

### EnhancedJournalEntryLine

```python
class EnhancedJournalEntryLine(BaseModel):
    line_number: int = Field(..., description="Line item number")
    account_number: str = Field(..., description="PCG account number")
    account_name: str = Field(..., description="PCG account name/title")
    description: str = Field(..., description="Line description")
    debit_amount: Optional[float] = Field(None, ge=0, description="Debit amount (null if credit)")
    credit_amount: Optional[float] = Field(None, ge=0, description="Credit amount (null if debit)")
    third_party_code: Optional[str] = Field(None, description="Third party code (customer/vendor)")
    analytical_code: Optional[str] = Field(None, description="Analytical accounting code")
    vat_code: Optional[str] = Field(None, description="VAT code (e.g., TVA20, TVA10)")
    vat_rate: Optional[float] = Field(None, ge=0, le=100, description="VAT rate percentage")
    line_reference: Optional[str] = Field(None, description="Reference to source line item")
```

**Complete Journal Entry Structure:**

The ImprovedFinalAccountingEntry provides:

- **Balance Validation**: Automatic debit/credit balance checking with 1-cent tolerance
- **French Compliance**: Proper journal type classification (JA, JV, BQ, OD)
- **Enhanced Line Items**: Complete PCG account details with VAT handling
- **Traceability**: Full audit trail to source documents
- **Status Tracking**: Real-time processing status updates

### JournalType

```python
class JournalType(str, Enum):
    SALES_JOURNAL = "sales_journal"  # Journal des Ventes (JV)
    PURCHASE_JOURNAL = "purchase_journal"  # Journal des Achats (JA)
    BANK_JOURNAL = "bank_journal"  # Journal de Banque (BQ)
    CASH_JOURNAL = "cash_journal"  # Journal de Caisse (CS)
    OPERATIONS_JOURNAL = "operations_journal"  # Journal des Opérations Diverses (OD)
```

**French Accounting Journal Types:**
- **JV**: Sales journal for customer invoices
- **JA**: Purchase journal for supplier invoices  
- **BQ**: Bank journal for bank transactions
- **CS**: Cash journal for cash operations
- **OD**: Miscellaneous operations journal

## Payment Models

### PaymentStatusEnum

```python
class PaymentStatusEnum(str, Enum):
    UNPAID = "unpaid"
    PAID = "paid"
    PARTIALLY_PAID = "partially_paid"
    OVERDUE = "overdue"
    CANCELLED = "cancelled"
```

### PaymentMethodEnum

```python
class PaymentMethodEnum(str, Enum):
    BANK_TRANSFER = "bank_transfer"
    CHECK = "check"
    CASH = "cash"
    CREDIT_CARD = "credit_card"
    DIRECT_DEBIT = "direct_debit"
    OTHER = "other"
```

### PaymentStatusUpdate

```python
class PaymentStatusUpdate(BaseModel):
    payment_status: PaymentStatusEnum = Field(..., description="Payment status")
    payment_method: Optional[PaymentMethodEnum] = Field(None, description="Payment method")
    payment_date: Optional[str] = Field(None, description="Payment date (YYYY-MM-DD)")
    paid_amount: Optional[float] = Field(None, ge=0, description="Amount paid")
    payment_reference: Optional[str] = Field(None, description="Payment reference")
    payment_notes: Optional[str] = Field(None, description="Additional payment notes")
```

**Payment Tracking Features:**
- Comprehensive status tracking with aging support
- French payment method support (virement, chèque, espèces)
- Partial payment handling with balance tracking
- Automatic payment reference generation

### FinancialJournalEntry

```python
class FinancialJournalEntry(BaseModel):
    entry_id: str = Field(..., description="Unique financial journal entry identifier")
    invoice_id: str = Field(..., description="Reference to original invoice")
    
    # Entry metadata
    entry_date: str = Field(..., description="Financial journal entry date (YYYY-MM-DD)")
    entry_reference: str = Field(..., description="Financial journal entry reference")
    entry_description: str = Field(..., description="Financial journal entry description")
    journal_type: str = Field(default="financial", description="Journal type (financial/payment)")
    
    # Payment information
    payment_status: PaymentStatusEnum = Field(..., description="Payment status")
    payment_method: PaymentMethodEnum = Field(..., description="Payment method")
    payment_amount: float = Field(..., ge=0, description="Payment amount")
    payment_reference: Optional[str] = Field(None, description="Payment reference")
    
    # Journal entry lines
    entry_lines: List[EnhancedJournalEntryLine] = Field(..., description="Financial journal entry lines")
    
    # Balance validation
    total_debit: float = Field(..., ge=0, description="Total debit amount")
    total_credit: float = Field(..., ge=0, description="Total credit amount")
    is_balanced: bool = Field(..., description="Whether entry is balanced")
    balance_difference: float = Field(default=0.0, description="Difference if unbalanced")
    
    # Processing metadata
    generated_at: datetime = Field(default_factory=datetime.now, description="Generation timestamp")
    created_at: datetime = Field(default_factory=datetime.now, description="Creation timestamp")
    updated_at: datetime = Field(default_factory=datetime.now, description="Last update timestamp")
```

**Financial Journal Features:**
- Separate payment journal entries from initial invoice journals
- Support for bank, cash, and operations journals (BQ, CS, OD)
- Automatic payment reconciliation and account clearing
- Balance validation for all financial transactions

## Financial Document Processing Models

### FinancialDocumentData

```python
class FinancialDocumentData(BaseModel):
    document_id: str = Field(..., description="Unique document identifier")
    document_type: DocumentType = Field(..., description="Type of document")
    document_date: Optional[str] = Field(None, description="Document date")
    reference_number: Optional[str] = Field(None, description="Document reference number")
    amount: Optional[float] = Field(None, description="Document amount")
    currency: str = Field(default="EUR", description="Currency code")
    description: Optional[str] = Field(None, description="Document description")
    parties: List[Dict[str, Any]] = Field(default_factory=list, description="Involved parties")
    line_items: List[Dict[str, Any]] = Field(default_factory=list, description="Document line items")
    metadata: Dict[str, Any] = Field(default_factory=dict, description="Additional metadata")
```

### DocumentProcessingRequest

```python
class DocumentProcessingRequest(BaseModel):
    invoice_id: str = Field(..., description="Associated invoice ID")
    document_type: DocumentType = Field(..., description="Type of document to process")
    file_path: str = Field(..., description="Path to the document file")
    force_regenerate: bool = Field(default=False, description="Force regeneration of existing entries")
    custom_context: Optional[Dict[str, Any]] = Field(None, description="Additional context for processing")
```

### IntelligentJournalRequest

```python
class IntelligentJournalRequest(BaseModel):
    invoice_id: str = Field(..., description="Associated invoice ID")
    document_data: FinancialDocumentData = Field(..., description="Extracted document data")
    journal_type: JournalType = Field(..., description="Target journal type")
    force_regenerate: bool = Field(default=False, description="Force regeneration of existing entries")
```

**Extended Document Processing:**
- Support for 20+ financial document types
- Bank statements, payroll, expense receipts, contracts
- Intelligent journal generation using LLM
- Custom context and metadata handling

## Utility Classes

### VATCodeGenerator

```python
@staticmethod
def generate_vat_code(vat_rate: float, invoice_type: InvoiceType) -> str:
    """Generate VAT code based on rate and invoice type."""
    if vat_rate == 0:
        return "TVA0"
    elif vat_rate == 10:
        return "TVA10"
    elif vat_rate == 20:
        return "TVA20"
    elif vat_rate == 5.5:
        return "TVA5.5"
    else:
        return f"TVA{vat_rate:.1f}"
```

### DueDateCalculator

```python
@staticmethod
def calculate_due_date(invoice_date: str, payment_terms: Optional[str] = None) -> Optional[str]:
    """Calculate due date from invoice date and payment terms."""
    # Supports 30/60/15 day terms, immediate payment, custom terms
```

### MultilingualDescriptionGenerator

```python
@staticmethod
def generate_entry_description(
    invoice_type: InvoiceType,
    party_name: str,
    invoice_number: str,
    language: str = "fr"
) -> str:
    """Generate entry description in specified language (fr/en)."""
```

**Business Logic Utilities:**
- Automatic VAT code generation for French tax compliance
- Due date calculation with payment terms parsing
- Multilingual journal descriptions (French/English)
- Account validation and PCG compliance checking

The Accounting Models provide a comprehensive foundation for French accounting automation, supporting the complete invoice-to-journal workflow with sophisticated validation, payment tracking, and extended financial document processing capabilities. 